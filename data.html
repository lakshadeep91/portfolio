<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    </head>
    <body>
        <canvas id="myChart"></canvas>
        <script>
            $.ajax({
                type: "GET",
                url: "https://mtret6uio3.execute-api.us-east-1.amazonaws.com/prod",
                dataType: 'json',
                crossDomain: true,
                contentType: "application/json",
                success: function(response){
                    processChart(response);
                }
            });
            function processChart(response) {
                var labels = [];
                var unique_visitors = [];
                var all_requests = [];
                $.each(response, function(date, val) {
                    labels.push(date);
                    unique_visitors.push(val[1]);
                    all_requests.push(val[2]);
                });
                labels = labels.reverse();
                unique_visitors = unique_visitors.reverse();
                all_requests = all_requests.reverse();
                var max_unique_visitors = Math.max.apply(Math, unique_visitors)
                var max_all_visitors = Math.max.apply(Math, all_requests)
                var max_count = max_unique_visitors;
                if(max_unique_visitors < max_all_visitors) {
                    max_count = max_all_visitors;
                }
                const data = {
                    labels: labels,
                    datasets: [
                        {
                        label: 'Unique Visitors',
                        data: unique_visitors,
                        fill: false,
                        cubicInterpolationMode: 'monotone',
                        tension: 0.4
                        }, {
                        label: 'All Requests',
                        data: all_requests,
                        fill: false,
                        tension: 0.4
                        }
                    ]
                    };
                const ctx = document.getElementById('myChart');
                new Chart(ctx, {
                type: 'line',
                data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Number of Visitors / Day'
                            },
                        },
                        interaction: {
                        intersect: false,
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Value'
                                },
                                suggestedMin: 0,
                                suggestedMax: max_all_visitors
                            }
                        }
                    },
                    animation: {
                        onComplete: () => {
                            delayed = true;
                        },
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default' && !delayed) {
                            delay = context.dataIndex * 300 + context.datasetIndex * 100;
                            }
                            return delay;
                        }
                    }
                });
            }
        </script>
    </body>
</html>